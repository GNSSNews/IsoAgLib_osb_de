OBJ_DIR_SERVER  = objects_server
OBJECTS_SERVER = $(patsubst %.cpp,$(OBJ_DIR_SERVER)/%.o,$(notdir $(SOURCES_SERVER)))
DEPS_SERVER := $(patsubst %.o,%.d,$(OBJECTS_SERVER))

$(OBJ_DIR_SERVER)/%.d :
	$(CXX) -c $(CXXFLAGS) $(INCPATH) -MM $(filter %/$(patsubst $(OBJ_DIR_SERVER)/%.d,%,$@).cpp,$(SOURCES_SERVER)) 2>/dev/null | \
	perl -p -e 's!^([^:]+:)!$(OBJ_DIR_SERVER)/$$1!' > $@

$(OBJ_DIR_SERVER)/%.o : $(filter %/$(patsubst $(OBJ_DIR_SERVER)/%.d,%,$@).cpp,$(SOURCES_SERVER)) $(OBJ_DIR_SERVER)/%.d
	$(CXX) $(CXXFLAGS) $(INCPATH)  -o $@ -c $(filter %/$(patsubst $(OBJ_DIR_SERVER)/%.o,%,$@).cpp,$(SOURCES_SERVER))

include $(DEPS_SERVER)

can_server: $(OBJECTS_SERVER)
	$(LINK) $(LFLAGS) -o can_server $(OBJECTS_SERVER) $(LIBS) $(LIBS_CAN_SERVER)
